<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/144.0.0.0 Safari/537.36" version="29.3.4">
  <diagram name="MCS-销售邮箱自动下单流程" id="q7KKbxqvQMhW9PS708VM">
    <mxGraphModel dx="483" dy="228" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="0" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-1" parent="1" style="swimlane;horizontal=1;startSize=28;fillColor=#ffffff;strokeColor=#c0c0c0;fontSize=14;" value="邮件解析生成订单流程" vertex="1">
          <mxGeometry height="1580" width="1040" x="30" y="70" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-2" parent="p8VhKJjiPpw8TDRZL9m_-1" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#eaf2ff;strokeColor=#2f5597;fontSize=13;" value="开始（新邮件到达）" vertex="1">
          <mxGeometry height="60" width="140" x="100" y="60" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-3" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#333333;fontSize=13;" value="接收新邮件（销售邮箱）" vertex="1">
          <mxGeometry height="60" width="220" x="60" y="160" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-4" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" value="是否满足触发条件？&#xa;- 外部邮箱&#xa;- 命中合同关键字&#xa;- 包含PDF附件&#xa;- message_id未处理" vertex="1">
          <mxGeometry height="140" width="240" x="50" y="240" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-5" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#333333;fontSize=13;" value="生成 EmailEvent" vertex="1">
          <mxGeometry height="60" width="220" x="60" y="440" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-7" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#333333;fontSize=13;" value="ERP 接口： 加载主数据快照&lt;br&gt;customers / contacts / products" vertex="1">
          <mxGeometry height="60" width="240" x="390" y="160" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-76" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="p8VhKJjiPpw8TDRZL9m_-13">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-11" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#333333;fontSize=13;" value="上传PDF至文件服务器&#xa;得到 file_url + sha256" vertex="1">
          <mxGeometry height="60" width="230" x="400" y="440" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-26" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;endArrow=block;endFill=1;" target="p8VhKJjiPpw8TDRZL9m_-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-27" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;" target="p8VhKJjiPpw8TDRZL9m_-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-28" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;fontSize=12;" target="p8VhKJjiPpw8TDRZL9m_-5" value="是">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-31" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;fontSize=12;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" target="p8VhKJjiPpw8TDRZL9m_-7" value="">
          <mxGeometry relative="1" x="-0.9167" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-33" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;exitX=0.456;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" target="p8VhKJjiPpw8TDRZL9m_-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-37" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;fontSize=12;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.436;entryY=0.009;entryDx=0;entryDy=0;entryPerimeter=0;" target="p8VhKJjiPpw8TDRZL9m_-11" value="是">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="490" y="510" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-8" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" value="发件人是否匹配联系人？&lt;br&gt;（contacts.email 精确匹配）&lt;br&gt;是否为采购合同邮件？&lt;br&gt;关键字 + PDF附件" vertex="1">
          <mxGeometry height="120" width="220" x="390" y="260" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-87" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" target="p8VhKJjiPpw8TDRZL9m_-15">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-88" connectable="0" parent="p8VhKJjiPpw8TDRZL9m_-87" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="是" vertex="1">
          <mxGeometry relative="1" x="-0.7814" y="-2" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-10" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" value="客户\销售员\交易主体\物料&lt;br&gt;唯一性取值与校验" vertex="1">
          <mxGeometry height="110" width="220" x="390" y="720" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-35" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;fontSize=12;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="p8VhKJjiPpw8TDRZL9m_-10" value="是">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-82" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" target="p8VhKJjiPpw8TDRZL9m_-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-79" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.457;entryY=-0.008;entryDx=0;entryDy=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryPerimeter=0;" target="p8VhKJjiPpw8TDRZL9m_-18">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-48" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;exitX=0.46;exitY=1.011;exitDx=0;exitDy=0;exitPerimeter=0;" target="p8VhKJjiPpw8TDRZL9m_-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-19" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=12;" value="ERP 返回成功？" vertex="1">
          <mxGeometry height="80" width="220" x="390" y="1100" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-113" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-91" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" target="p8VhKJjiPpw8TDRZL9m_-112">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-91" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#333333;fontSize=13;" value="订单创建&amp;nbsp;&lt;br&gt;OrderEvent" vertex="1">
          <mxGeometry height="60" width="240" x="390" y="1240" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-92" edge="1" parent="p8VhKJjiPpw8TDRZL9m_-1" source="p8VhKJjiPpw8TDRZL9m_-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.456;entryY=-0.004;entryDx=0;entryDy=0;entryPerimeter=0;" target="p8VhKJjiPpw8TDRZL9m_-91">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-93" connectable="0" parent="p8VhKJjiPpw8TDRZL9m_-92" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="是" vertex="1">
          <mxGeometry relative="1" x="-0.4822" y="-4" as="geometry">
            <mxPoint x="4" y="4" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-18" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;fontSize=13;" value="ERP 接口：创建销售订单&lt;br&gt;（附件 ID 也要写到订单相关接口）" vertex="1">
          <mxGeometry height="70" width="240" x="390" y="994" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-13" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;" value="调用 Dify Agent：&lt;br&gt;客户采购合同识别" vertex="1">
          <mxGeometry height="70" width="200" x="770" y="435" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-14" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rhombus;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontSize=12;" value="合同解析是否成功？" vertex="1">
          <mxGeometry height="80" width="220" x="390" y="600" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-15" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rounded=0;whiteSpace=wrap;html=1;strokeWidth=2;fillColor=#e1d5e7;strokeColor=#9673a6;fontSize=13;" value="调用 Dify Agent：&lt;br&gt;客户订单模板&lt;br&gt;生成接口报文" vertex="1">
          <mxGeometry height="70" width="200" x="770" y="860" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-112" parent="p8VhKJjiPpw8TDRZL9m_-1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#333333;fontSize=13;" value="通知跟单客服&lt;br&gt;（成功）" vertex="1">
          <mxGeometry height="70" width="200" x="770" y="1235" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-100" edge="1" parent="1" source="p8VhKJjiPpw8TDRZL9m_-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" target="p8VhKJjiPpw8TDRZL9m_-21">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-20" parent="1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#ffffff;strokeColor=#333333;fontSize=13;" value="发送结果邮件给销售&lt;br&gt;（成功/失败/待确认）&lt;br&gt;&lt;font style=&quot;color: rgb(255, 51, 51);&quot;&gt;邮件增加状态标记&lt;/font&gt;" vertex="1">
          <mxGeometry height="70" width="240" x="240" y="1430" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-21" parent="1" style="ellipse;whiteSpace=wrap;html=1;aspect=fixed;fillColor=#f5f5f5;strokeColor=#666666;fontSize=13;" value="结束" vertex="1">
          <mxGeometry height="60" width="140" x="290" y="1550" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-36" edge="1" parent="1" source="p8VhKJjiPpw8TDRZL9m_-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;fontSize=12;exitX=1;exitY=0.5;exitDx=0;exitDy=0;" target="p8VhKJjiPpw8TDRZL9m_-21" value="否">
          <mxGeometry relative="1" x="-0.9739" as="geometry">
            <mxPoint as="offset" />
            <Array as="points">
              <mxPoint x="720" y="390" />
              <mxPoint x="720" y="1580" />
            </Array>
            <mxPoint x="650" y="420" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-70" edge="1" parent="1" source="p8VhKJjiPpw8TDRZL9m_-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;endArrow=block;endFill=1;fontSize=12;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;" target="p8VhKJjiPpw8TDRZL9m_-21" value="">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="40" y="380" />
              <mxPoint x="40" y="1580" />
            </Array>
            <mxPoint x="330" y="380" as="sourcePoint" />
            <mxPoint x="360" y="1430" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-83" connectable="0" parent="p8VhKJjiPpw8TDRZL9m_-70" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="否" vertex="1">
          <mxGeometry relative="1" x="-0.9559" as="geometry">
            <mxPoint x="11" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-97" edge="1" parent="1" source="p8VhKJjiPpw8TDRZL9m_-19" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="p8VhKJjiPpw8TDRZL9m_-20">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="360" y="1500" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-101" connectable="0" parent="p8VhKJjiPpw8TDRZL9m_-97" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="否" vertex="1">
          <mxGeometry relative="1" x="-0.8107" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-98" edge="1" parent="1" source="p8VhKJjiPpw8TDRZL9m_-91" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;exitX=0.457;exitY=1.01;exitDx=0;exitDy=0;exitPerimeter=0;" target="p8VhKJjiPpw8TDRZL9m_-20">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="460" y="1537" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-84" edge="1" parent="1" source="p8VhKJjiPpw8TDRZL9m_-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" target="p8VhKJjiPpw8TDRZL9m_-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-86" connectable="0" parent="p8VhKJjiPpw8TDRZL9m_-84" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="否" vertex="1">
          <mxGeometry relative="1" x="-0.9241" as="geometry">
            <mxPoint x="-5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-110" edge="1" parent="1" source="p8VhKJjiPpw8TDRZL9m_-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;" target="p8VhKJjiPpw8TDRZL9m_-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="p8VhKJjiPpw8TDRZL9m_-111" connectable="0" parent="p8VhKJjiPpw8TDRZL9m_-110" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];" value="否" vertex="1">
          <mxGeometry relative="1" x="-0.9262" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
